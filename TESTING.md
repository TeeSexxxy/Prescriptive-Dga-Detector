# âœ… TESTING.md: Manual Verification for Prescriptive DGA Detector

This file documents two manual test cases â€” one for a suspicious DGA domain and one for a legitimate domain â€” to verify that the full detection-to-prescription pipeline is functional and accurate.

---

## í·ª Test Case 1: Suspicious Domain (Expected DGA)

- **Input Domain**: `kq3v9z7j1x5f8g2h.info`
- **Command**:
  ```bash
  python 2_analyze_domain.py --domain kq3v9z7j1x5f8g2h.info

Expected Output:

Classification: DGA

SHAP-style XAI summary printed

Generative AI playbook generated and printed to console

âœ… Actual Output Highlights:

Prediction: DGA (Confidence: 36.0%)

XAI summary:

High entropy: 4.3

High length: 21

A complete incident response playbook was generated by GenAI
=== XAI Summary ===

- Alert: Potential DGA domain detected.
- Domain: 'kq3v9z7j1x5f8g2h.info'
- AI Model Explanation (from SHAP-style logic): The model flagged this domain with 36.0% confidence. The classification was primarily driven by:
  - A high 'entropy' value of 4.3 (which strongly pushed the prediction towards 'dga').
  - A high 'length' value of 21 (which also pushed the prediction towards 'dga').


=== Generating Incident Response Playbook ===

## Incident Response Playbook: Potential DGA Domain Detected

**Incident ID:** [Auto-generated ID]
**Date/Time:** [Timestamp]
**Alert Type:** Potential DGA Domain Detection
**Source:** AI-driven DGA Detection Model

**1. Initial Assessment:**

* **Verify Alert:**  Confirm the alert details (domain: 'kq3v9z7j1x5f8g2h.info', confidence: 36%). Investigate the alert source and ensure no false positives are reported from the model.  Review the model's recent accuracy and recall.
* **Domain Information Gathering:** Perform WHOIS lookup on 'kq3v9z7j1x5f8g2h.info'.  Note registration date, registrant information, name servers, and any other relevant details. Check VirusTotal and other threat intelligence platforms for existing reports on the domain.
* **Internal Impact Assessment:**  Determine if the domain is currently being accessed from within the organization's network (e.g., using DNS logs, firewall logs, endpoint detection and response (EDR) logs). Identify affected systems or users.  Pay close attention to unusual DNS queries or network traffic originating from suspicious IP addresses.

**2. Containment:**

* **Network-level Containment:** If internal access is detected, immediately block the domain at the DNS level (using DNS filtering or a firewall) to prevent further communication.  Consider blocking related suspicious IP addresses if identified in the previous steps.
* **Endpoint-level Containment:** If the domain is being accessed from specific endpoints, initiate remediation steps (see Section 3).

**3. Eradication & Remediation:**

* **Affected Endpoint Analysis:** For compromised endpoints, conduct a thorough malware analysis using EDR tools. This may involve memory forensics, process analysis, and file analysis.
* **Malware Removal:** Remove any identified malware from affected systems.  Restore systems from backups if necessary.
* **Vulnerability Assessment:**  Determine if the endpoint compromise is due to a known vulnerability.  Patch and remediate vulnerabilities promptly.

**4. Recovery:**

* **System Restore:** Restore affected systems to a clean state. Verify system integrity.
* **Monitor Network Traffic:** Monitor network traffic for any further suspicious activity related to the DGA or similar domains.
* **User Education:** Educate users about phishing scams and safe browsing practices to prevent future incidents.

**5. Post-Incident Activity:**

* **Threat Hunting:** Expand the investigation to look for other potential compromised systems or indicators of compromise (IOCs) related to the DGA family.
* **Update Threat Intelligence:** Share the identified DGA domain and associated IOCs with your threat intelligence platform and other security teams.
* **Report and Documentation:** Document the incident response process thoroughly, including all actions taken, results, and lessons learned.  Generate a report for relevant stakeholders.

**Escalation Criteria:**

* Persistent attempts to access the blocked domain despite containment efforts.
* Evidence of data exfiltration or significant system compromise.
* Difficulty in containing the threat.


**Note:** The 36% confidence level warrants investigation but is relatively low. This playbook prioritizes investigation and containment due to the DGA nature of the domain and the model's supporting evidence (high entropy and length).  The investigation should focus on validating the threat and prioritizing mitigation steps based on the evidence discovered during initial assessment.  Continuously reassess risk based on new information.


## ï¿½ï¿½ï¿½ Test Case 2: Suspicious Domain (Expected DGA)   
$ python 2_analyze_domain.py --domain openai.com
[+] Input domain: openai.com
[+] Computed feat2ures â†’ Length: 10, Entropy: 3.12

[+] Prediction: LEGIT (Confidence: 98.6%)
[+] Domain appears legitimate. No playbook generated.
Closing connection _sid_aea6 at exit
H2O session _sid_aea6 closed.
(venv) 
CSD@User MINGW64 ~/prescriptive-dga-detector
$

Summary

Both tests confirm the following:

H2O MOJO model loads and predicts correctly

Feature engineering (length, entropy) works as expected

SHAP values are interpreted and summarized

GenAI produces dynamic, context-aware playbooks only for DGA detections
